cabinet = Hash.new

HELLO_MESSAGE = "Here we go again!"
GOODBYE_MESSAGE = "Thanks for listening! We'll be back tomorrow morning at noon!"
TIME_TO_WAIT = 5 # Seconds to wait  before making an annoucement if a winner is found and no new prize is selected

interval = "In just under 1 hour"

cabinet[:shelf] = ""
cabinet[:rack] = ""
cabinet[:winner] = ""	

before_dying do
	puts cabinet.inspect
end

loop {
	line = get
	
	# Raffle draws and item drops to the rack
	if line =~ /^A hidden panel beneath (.*) opens/
		cabinet[:rack] = $1.to_s
		cabinet[:winner] = nil
		cabinet[:shelf] = nil
	end
	
	# Winner is announced
	if line =~ /^And the winner of (.*) is... (.*)!/
		cabinet[:winner] = $2.to_s
	end
	
	# A new item is added to the shelf
	if line =~ /^A mechanical mithril hand emerges from beneath an open panel and replenishes the empty spot along the shelf with (.*?)\./
		cabinet[:shelf] = $1.to_s
	end
	
	# Known Winner and NOT End of Day
	if cabinet[:rack] && cabinet[:winner] && cabinet[:shelf]
		respond " "
		respond "[TREASURE TROVE] Congratulations to the lucky Treasure Trove winner this hour for: #{cabinet[:rack]}, it's #{cabinet[:winner]}! #{interval} the next item at the Treasure Trove will pull for: #{cabinet[:shelf]}."
		respond " "
		break
	
	# Known Winner and End of Day
	elsif cabinet[:rack] && cabinet[:winner] && !cabinet[:shelf]
		respond " "
		respond "[TREASURE TROVE] Congratulations to the lucky Treasure Trove winner this hour for: #{cabinet[:rack]}, it's #{cabinet[:winner]}! #{GOODBYE_MESSAGE}"
		respond " "
		break
	
	# Unknown Winner and NOT End of Day
	elsif cabinet[:rack] && !cabinet[:winner] && cabinet[:shelf]
		respond " "
		respond "[TREASURE TROVE] Congratulations to the lucky Treasure Trove winner this hour for: #{trove[:latest_prize]}, but we don't know their name because they're not logged in; they have under an hour to claim their win, though. #{interval} the next item at the Treasure Trove will pull for: #{trove[:current_prize]}."
		respond " "
		break
	
	# Unknown Winner and End of Day
	elsif cabinet[:rack] && !cabinet[:winner] && !cabinet[:shelf]
		respond " "
		respond "[TREASURE TROVE] Congratulations to the lucky Treasure Trove winner this hour for: #{trove[:latest_prize]}, but we don't know their name because they're not logged in; they have under an hour to claim their win, though. #{GOODBYE_MESSAGE}."
		respond " "
	end
	
	cabinet[:rack] = ""
	cabinet[:winner] = ""
	cabinet[:shelf] = ""
}
